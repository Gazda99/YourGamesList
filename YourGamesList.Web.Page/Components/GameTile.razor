@using YourGamesList.Contracts.Dto
@using YourGamesList.Web.Page.Services.StaticState
@using YourGamesList.Web.Page.Services.Ygl.Model


<style>
    .add-to-list-button-container {
        position: absolute;
        bottom: 8px;
        right: 8px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .game-tile-card {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }

    .game-tile-card:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .game-tile-card:hover .add-to-list-button-container {
        opacity: 1;
    }
</style>

<MudCard Outlined="true" Style="position: relative;" Class="game-tile-card">
    <MudStack Row="true">
        <MudImage Src="@ImageUrl()" Width="176" Height="235"></MudImage>
        <MudStack Style="width: 100%;">
            <MudStack>
                <MudText>@Game.Name</MudText>
                <MudText>@FormatReleaseDate()</MudText>
                <MudText>@TruncateText(Game.Summary, 150)</MudText>
            </MudStack>
        </MudStack>
    </MudStack>
    <div class="add-to-list-button-container">
        <MudIconButton Icon="@Icons.Material.Outlined.BookmarkAdd" Shape="Shape.Circle" Size="Size.Small" OnClick="@AddToList"></MudIconButton>
    </div>
</MudCard>


@code {
    [Inject] private IDialogService DialogService { get; set; } = default!;


    private const string GameReleaseDateFormat = "yyyy MMMM dd";

    [Parameter] public required GameDto Game { get; set; }

    private string ImageUrl()
    {
        return !string.IsNullOrWhiteSpace(Game.ImageId) ? $"https://images.igdb.com/igdb/image/upload/t_cover_big/{Game.ImageId}.jpg" : "";
    }

    private string FormatReleaseDate()
    {
        return Game.FirstReleaseDate != 0 ? DateTimeOffset.FromUnixTimeSeconds(Game.FirstReleaseDate).ToString(GameReleaseDateFormat) : string.Empty;
    }

    private static string TruncateText(string text, int maxLength)
    {
        if (maxLength <= 10)
        {
            maxLength = 10;
        }

        return text.Length >= maxLength ? $"{text[0..(maxLength - 3)]}..." : text;
    }

    private async Task AddToList()
    {
        var dialog = await DialogService.ShowAsync<UserListsDialog>("Choose list");
        var result = await dialog.Result;
        if (result is not { Canceled: true })
        {
        }
    }

}